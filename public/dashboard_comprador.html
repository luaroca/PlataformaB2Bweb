<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Comprador</title>
    <link rel="stylesheet" href="dashboard_comprador.css">
</head>

<body>
    <div class="container">
        
    </div>
    <script>
        const usuarioId = localStorage.getItem('usuarioId');
        async function cargarProductos() {
            try {
                const res = await fetch(`/api/productos/proveedor/${usuarioId}`);
                if (!res.ok) throw new Error('Error al obtener productos');

                const { productos } = await res.json();
                const contenedor = document.getElementById('productosContainer');
                contenedor.innerHTML = '';

                productos.forEach(p => {
                    const card = document.createElement('div');
                    card.className = 'col';
                    card.innerHTML = `
            <div class="card h-100">
              <div class="card-body d-flex flex-column">
                <h5 class="card-title">${p.nombre}</h5>
                <p class="card-text mb-1">${p.descripcion}</p>
                <p class="mb-1"><strong>Precio:</strong> $${p.precio}</p>
                <p class="mb-1"><strong>Stock:</strong> ${p.stock}</p>
                <p class="mb-3"><strong>Publicado:</strong> ${p.publicado ? 'Sí' : 'No'}</p>
                <button class="btn btn-success mb-2" onclick="publicarProducto(${p.id})">Publicar</button>
                <button class="btn btn-warning mb-2" onclick="editarProducto(${p.id})">Editar</button>
                <button class="btn btn-danger" onclick="eliminarProducto(${p.id})">Eliminar</button>
              </div>
            </div>
          `;
                    contenedor.appendChild(card);
                });
            } catch (error) {
                console.error(error);
                alert('Error al cargar los productos.');
            }
        }

        async function publicarProducto(id) {
            await fetch(`/api/productos/publicar/${id}`, { method: 'PUT' });
            cargarProductos();
        }

        function editarProducto(id) {
            alert('Funcionalidad de edición pendiente');
        }

        async function eliminarProducto(id) {
            if (confirm('¿Estás seguro de eliminar este producto?')) {
                await fetch(`/api/productos/${id}`, { method: 'DELETE' });
                cargarProductos();
            }
        }

        cargarProductos();
    </script>
</body>

</html>