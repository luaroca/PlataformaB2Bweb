<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mis Productos | Provecta</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <style>
    body {
      background-color: #f8f9fa;
    }
    .titulo-principal {
      color: #1F4E60;
    }
    .btn-regresar {
      background-color: #226776;
      color: white;
      border: none;
    }
    .btn-regresar:hover {
      background-color: #1F4E60;
    }
    .card {
      border-radius: 1rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
    }
    .card-title {
      color: #226776;
      font-weight: bold;
    }
    .btn-success, .btn-warning, .btn-danger {
      width: 100%;
    }
    .btn-success {
      background-color: #5594A3;
      border: none;
    }
    .btn-success:hover {
      background-color: #1F4E60;
    }
  </style>
</head>
<body>

  <div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="titulo-principal">Mis Productos</h2>
      <button class="btn btn-regresar" onclick="window.location.href='productos.html'">← Regresar</button>
    </div>

    <div id="productosContainer" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4"></div>
  </div>

  <script>
    const usuarioId = localStorage.getItem('usuarioId');
    if (!usuarioId) {
      alert('Debes iniciar sesión.');
      window.location.href = 'login.html';
    }

    async function cargarProductos() {
      try {
        const res = await fetch(`/api/productos/proveedor/${usuarioId}`);
        if (!res.ok) throw new Error('Error al obtener productos');

        const { productos } = await res.json();
        const contenedor = document.getElementById('productosContainer');
        contenedor.innerHTML = '';

        productos.forEach(p => {
          const card = document.createElement('div');
          card.className = 'col';
          card.innerHTML = `
            <div class="card h-100">
              <div class="card-body d-flex flex-column">
                <h5 class="card-title">${p.nombre}</h5>
                <p class="card-text mb-1">${p.descripcion}</p>
                <p class="mb-1"><strong>Precio:</strong> $${p.precio}</p>
                <p class="mb-1"><strong>Stock:</strong> ${p.stock}</p>
                <p class="mb-3"><strong>Publicado:</strong> ${p.publicado ? 'Sí' : 'No'}</p>
                <button class="btn btn-success mb-2" onclick="publicarProducto(${p.id})">Publicar</button>
                <button class="btn btn-warning mb-2" onclick="editarProducto(${p.id})">Editar</button>
                <button class="btn btn-danger" onclick="eliminarProducto(${p.id})">Eliminar</button>
              </div>
            </div>
          `;
          contenedor.appendChild(card);
        });
      } catch (error) {
        console.error(error);
        alert('Error al cargar los productos.');
      }
    }

    async function publicarProducto(id) {
      await fetch(`/api/productos/publicar/${id}`, { method: 'PUT' });
      cargarProductos();
    }

    function editarProducto(id) {
      alert('Funcionalidad de edición pendiente');
    }

    async function eliminarProducto(id) {
      if (confirm('¿Estás seguro de eliminar este producto?')) {
        await fetch(`/api/productos/${id}`, { method: 'DELETE' });
        cargarProductos();
      }
    }

    cargarProductos();
  </script>
</body>
</html>
