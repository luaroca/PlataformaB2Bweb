<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detalle del Producto | Provecta</title>
    <link rel="stylesheet" href="detalle_producto.css" />
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
    <header class="navbar">
        <a href="index.html" class="logo">Provecta</a>
        <nav>
            <a href="login.html" class="btn">Iniciar Sesi칩n</a>
            <a href="registro.html" class="btn-outline">Registrarse</a>
        </nav>
    </header>
    <div>
        <h2><span id()></span></h2>
    </div>
    <div>

    </div>
    <div>

    </div>
    <div>

    </div>
    <div>

    </div>
    <script>
        async function cargarDetalleProducto(productoId) {
            try {
                const response = await fetch(`/producto-detalle/${productoId}`);
                const data = await response.json();
                const producto = data.producto;

                // Carga im치genes si existen
                function mostrarOCultarImagen(id, imagen) {
                    const img = document.getElementById(id);
                    if (imagen && imagen.trim() !== "") {
                        img.src = `/uploads/${imagen}`;
                        img.style.display = "block";
                    } else {
                        img.style.display = "none";
                    }
                }

                mostrarOCultarImagen("img_1", producto.imagen_principal);
                mostrarOCultarImagen("img_2", producto.imagen_secundaria1);
                mostrarOCultarImagen("img_3", producto.imagen_secundaria2);
                mostrarOCultarImagen("imagen_producto", producto.imagen_principal);

                // Datos principales
                document.getElementById("nombre").textContent = producto.nombre;
                document.getElementById("descripcion").textContent = producto.descripcion;
                document.getElementById("descripcion_larga").textContent = producto.descripcion;
                document.getElementById("proveedor").textContent = producto.proveedor_nombre;
                document.getElementById("unidad_medida").textContent = producto.unidad_medida;
                document.getElementById("origen_producto").textContent = producto.origen_producto;
                document.getElementById("tiempo_entrega").textContent = producto.tiempo_entrega;
                document.getElementById("precio").textContent = parseFloat(producto.precio).toLocaleString('es-CO');
                document.getElementById("precio_anterior").textContent = (producto.precio * 1.15).toFixed(2);
                document.getElementById("stock").textContent = producto.stock;
                document.getElementById("minimo_pedido").textContent = producto.minimo_pedido;

                cargarProductosRelacionados(producto.categoria);
            } catch (err) {
                console.error("Error al cargar producto:", err);
            }
        }

        async function cargarProductosRelacionados(categoria) {
            try {
                const response = await fetch(`/productos-relacionados/${categoria}`);
                const data = await response.json();
                const contenedor = document.getElementById("productos_relacionados");

                contenedor.innerHTML = "";

                if (data.success && data.productos.length > 0) {
                    data.productos.forEach(producto => {
                        const div = document.createElement("div");
                        div.className = "bg-black text-white p-2 rounded cursor-pointer";
                        div.innerHTML = `
              <img src="${producto.imagen_principal ? `/uploads/${producto.imagen_principal}` : 'imagen-placeholder.jpg'}"
                   alt="${producto.nombre}" class="w-full h-24 object-cover rounded mb-2" />
              <p class="text-sm">${producto.nombre}</p>
            `;
                        div.onclick = () => {
                            localStorage.setItem("det_id_producto", producto.id);
                            location.reload();
                        };
                        contenedor.appendChild(div);
                    });
                } else {
                    contenedor.innerHTML = "<p>No hay productos relacionados.</p>";
                }
            } catch (err) {
                console.error("Error al cargar productos relacionados:", err);
            }
        }

        // Cargar al abrir la p치gina
        const id_producto = localStorage.getItem("det_id_producto");
        if (id_producto) {
            cargarDetalleProducto(id_producto);
        } else {
            console.warn("No se encontr칩 ID de producto en localStorage.");
        }
    </script>

</body>

</html>