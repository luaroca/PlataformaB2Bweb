<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perfil de Usuario | Provecta</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="perfil.css" />
</head>
<body>

  <div class="card-profile">
    <h2>Mi Perfil</h2>
    <div id="perfil-info" class="profile-info text-start">
      <p class="text-muted text-center">Cargando información...</p>
    </div>

    <!-- Contenedor dinámico para botones de proveedor -->
    <div id="opciones-proveedor" class="mt-3 d-flex gap-3 justify-content-center flex-wrap"></div>

    <div class="btn-group-profile">
      <a href="productos.html" class="btn btn-secondary">Volver</a>
      <button class="btn btn-danger" onclick="cerrarSesion()">Cerrar Sesión</button>
    </div>
  </div>

  <script>
    async function cargarPerfil() {
      const usuarioId = localStorage.getItem('usuarioId');

      if (!usuarioId) {
        alert('No has iniciado sesión.');
        window.location.href = 'login.html';
        return;
      }

      try {
        const response = await fetch(`/perfil/${usuarioId}`);
        const data = await response.json();

        if (data.success) {
          const usuario = data.usuario;

          document.getElementById('perfil-info').innerHTML = `
            <div><strong>Nombre:</strong> ${usuario.nombre}</div>
            <div><strong>Correo:</strong> ${usuario.correo}</div>
            <div><strong>Teléfono:</strong> ${usuario.telefono}</div>
            <div><strong>Cédula:</strong> ${usuario.cedula}</div>
            <div><strong>Rol:</strong> ${usuario.rol}</div>
          `;

          // Si el usuario es proveedor, muestra botones extra
          if (usuario.rol.toLowerCase() === 'proveedor') {
            document.getElementById('opciones-proveedor').innerHTML = `
              <a href="mis-productos.html" class="btn btn-outline-primary">Mis Productos</a>
              <a href="crear-producto.html" class="btn btn-outline-success">Crear Producto</a>
            `;
          }

        } else {
          document.getElementById('perfil-info').innerHTML = `<p class="text-danger text-center">${data.message}</p>`;
        }
      } catch (error) {
        console.error('❌ Error al cargar perfil:', error);
        document.getElementById('perfil-info').innerHTML = '<p class="text-danger text-center">Error al cargar los datos del perfil.</p>';
      }
    }

    function cerrarSesion() {
      localStorage.clear();
      window.location.href = 'login.html';
    }

    window.onload = cargarPerfil;
  </script>

</body>
</html>
