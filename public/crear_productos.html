<!DOCTYPE html> 
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Crear Producto | Provecta</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="crear_productos.css">
</head>
<body>
  <div class="container my-4">
    <h2 class="mb-4">Crear Producto</h2>

    <form id="formularioProducto" enctype="multipart/form-data">
      <div class="mb-3">
        <label for="nombre" class="form-label">Nombre del Producto</label>
        <input type="text" class="form-control" id="nombre" name="nombre" required />
      </div>

      <div class="mb-3">
        <label for="descripcion" class="form-label">Descripción</label>
        <textarea class="form-control" id="descripcion" name="descripcion" required></textarea>
      </div>

      <div class="mb-3">
        <label for="categoria" class="form-label">Categoría</label>
        <select class="form-select" id="categoria" name="categoria" required>
          <option value="">Seleccione una categoría</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="subcategoria" class="form-label">Subcategoría</label>
        <select class="form-select" id="subcategoria" name="subcategoria" required disabled>
          <option value="">Seleccione una subcategoría</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="unidad_medida" class="form-label">Unidad de Medida</label>
        <select class="form-select" id="unidad_medida" name="unidad_medida" required>
          <option value="">Seleccione una unidad</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="minimo_pedido" class="form-label">Cantidad mínima de pedido</label>
        <input type="number" class="form-control" id="minimo_pedido" name="minimo_pedido" required />
      </div>

      <div class="mb-3">
        <label for="tiempo_entrega" class="form-label">Tiempo de entrega estimado</label>
        <input type="text" class="form-control" id="tiempo_entrega" name="tiempo_entrega" placeholder="Ej: 5-7 días" required />
      </div>

      <div class="mb-3">
        <label for="condiciones_pago" class="form-label">Condiciones de pago</label>
        <select class="form-select" id="condiciones_pago" name="condiciones_pago" required>
          <option value="">Seleccione condición</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="origen_producto" class="form-label">Origen del producto</label>
        <input type="text" class="form-control" id="origen_producto" name="origen_producto" placeholder="Ej: Medellín, Colombia" required />
      </div>

      <div class="mb-3">
        <label for="precio" class="form-label">Precio por unidad</label>
        <input type="number" step="0.01" class="form-control" id="precio" name="precio" required />
      </div>

      <div class="mb-3">
        <label for="stock" class="form-label">Stock disponible</label>
        <input type="number" class="form-control" id="stock" name="stock" required />
      </div>

      <div class="mb-3">
        <label for="imagenes" class="form-label">Imágenes del producto (puedes seleccionar varias)</label>
        <input type="file" class="form-control" id="imagenes" name="imagenes" accept="image/*" multiple required />
      </div>

      <button type="submit" class="btn btn-primary w-100">Guardar Producto</button>
    </form>

    <div class="text-center mt-3">
      <a href="dashboard_comprador.html" class="btn btn-outline-secondary">Volver al Perfil</a>
    </div>
  </div>

  <script>
    // Datos estáticos simulando datos de Alibaba
    const categorias = {
      "Electrónica": ["Teléfonos móviles", "Computadoras", "Accesorios electrónicos"],
      "Ropa": ["Hombres", "Mujeres", "Niños"],
      "Hogar": ["Muebles", "Decoración", "Electrodomésticos"]
    };

    const unidadesMedida = ["pieza", "caja", "kg", "litro", "metro"];
    const condicionesPago = ["Transferencia bancaria", "Contra entrega", "Tarjeta de crédito", "PayPal"];

    // Referencias
    const selectCategoria = document.getElementById('categoria');
    const selectSubcategoria = document.getElementById('subcategoria');
    const selectUnidad = document.getElementById('unidad_medida');
    const selectPago = document.getElementById('condiciones_pago');

    // Cargar categorías
    function cargarCategorias() {
      for (const cat in categorias) {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        selectCategoria.appendChild(option);
      }
    }

    // Cargar subcategorías según categoría seleccionada
    selectCategoria.addEventListener('change', () => {
      const seleccion = selectCategoria.value;
      selectSubcategoria.innerHTML = '<option value="">Seleccione una subcategoría</option>';
      if (seleccion && categorias[seleccion]) {
        categorias[seleccion].forEach(sub => {
          const option = document.createElement('option');
          option.value = sub;
          option.textContent = sub;
          selectSubcategoria.appendChild(option);
        });
        selectSubcategoria.disabled = false;
      } else {
        selectSubcategoria.disabled = true;
      }
    });

    // Cargar unidades de medida
    function cargarUnidades() {
      unidadesMedida.forEach(u => {
        const option = document.createElement('option');
        option.value = u;
        option.textContent = u;
        selectUnidad.appendChild(option);
      });
    }

    // Cargar condiciones de pago
    function cargarCondicionesPago() {
      condicionesPago.forEach(c => {
        const option = document.createElement('option');
        option.value = c;
        option.textContent = c;
        selectPago.appendChild(option);
      });
    }

    // Inicializar selects
    cargarCategorias();
    cargarUnidades();
    cargarCondicionesPago();

    // Form submit (tu código existente)
    const form = document.getElementById('formularioProducto');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const proveedorId = localStorage.getItem('usuarioId');
      if (!proveedorId) {
        alert('Debes iniciar sesión primero.');
        return window.location.href = 'login.html';
      }

      const formData = new FormData(form);
      formData.append('proveedor_id', proveedorId);

      try {
        const res = await fetch('/api/productos', {
          method: 'POST',
          body: formData
        });

        const data = await res.json();

        if (data.success) {
          alert('✅ Producto creado correctamente');
          form.reset();
          selectSubcategoria.disabled = true; // Reset subcategoria también
        } else {
          alert('❌ Error: ' + data.message);
        }
      } catch (error) {
        alert('❌ Error en la conexión al servidor');
        console.error(error);
      }
    });
  </script>
</body>
</html>